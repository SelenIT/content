---
title: Веб-сервер
name: webserver
authors:
  - igsekor
contributors:
  - furtivite
summary:
  - ports
  - gzip
  - brotli
  - headers
  - заголовки
  - сжатие
---

## Кратко

Веб-сервер — это специальная программа, которая принимает запросы пользователей, обрабатывает их и отсылает обратно по протоколу прикладного уровня [HTTP](https://ru.wikipedia.org/wiki/HTTP).

## Как понять

Для современных приложений часто применяют клиент-серверную архитектуру по принципу «один сервер — много клиентов». Сервером выступает сетевой сервис (подробнее об этом в [статье о настройке сети](/tools/articles/network)). Клиентом обычно является программа пользователя, например, браузер.  [Веб-приложения](/js/articles/web-app-types) являются, по сути, набором текстовых файлов, которые пересылаются пользователю от специальной программы — веб-сервера. Понятие _веб-сервер_ появилось в 1991 году с появлением первой такой [программы](https://ru.wikipedia.org/wiki/CERN_httpd).

Работа веб-сервера сводится к следующей схеме:

![Схема работы веб-сервера](images/1.png)

Сервер получает запросы от клиентов и отправляет им ответы. В основе работы веб-сервера лежит протокол HTTP.

### Протокол HTTP

Протокол HTTP (HyperText Transfer Protocol — протокол передачи гипертекста) работает с текстовыми сообщениями, которые пересылаются от клиента к серверу (HTTP-запрос) и обратно (HTTP-ответ). Структура сообщения следующая:

1. Стартовая строка (Starting line), которая отвечает за определение типа сообщения;
2. Заголовки (Headers), которые описывают тело сообщения, параметры передачи и прочие сведения;
3. Тело сообщения (Message Body) — данные.

**Стартовая строка**

В стартовой строке запроса указывается метод, ссылка и версия протокола, разделённые пробелом, например:

```
GET /tools/articles/webserver HTTP/2.0
```

Методы HTTP-запроса устанавливают назначение запроса. Среди наиболее используемых `GET`, `POST` и `OPTIONS`. Когда вы набираете адрес в адресной строке браузера и переходите по ссылке, обычно вы пользуетесь методом `GET`, то есть методом для получения запрашиваемой информацией. `POST` часто используется для отправки данных из форм, а `OPTIONS` — для определения набора методов на сервере, доступных по адресу.

Адрес, который вы вводите в адресной строке браузера, в протоколе HTTP определяется как URI (Uniform Resource Identifier), то есть последовательность символов, идентифицирующая абстрактный или физический ресурс.

Версия протокола обязательно указывается в запросе, поскольку от неё зависит способ передачи данных и набор доступных методов.

Стартовая строка HTTP-ответа содержит:

- информацию о версии протокола, как в запросе;
- код состояния (Status Code), который однозначно определяет реакцию сервера на запрос;
- пояснение (Reason Phrase) к коду ответа для пользователя (является необязательным).

Во время отладки веб-приложений вы часто будете встречать коды ответов `200`, `404` и `500`. Коды ответов, которые начинаются на `2xx`, сервер возвращает, если запрос клиента был удачным. Запросы `4xx` сообщают клиенту об ошибке, а `5xx` — о том, что веб-сервер не справился с запросом клиента.

**Заголовки**

Каждый заголовок в HTTP-сообщении представляется отдельной строкой с параметром и значением, разделёнными двоеточием. В заголовках содержится информация о домене, о сжатии, шифровании и формате данных, кодировке и прочая важная информация, которая используется для запроса или ответа.

Пример заголовков запроса:

```
Accept-Language: en-us
Accept-Encoding: gzip, deflate, br
```

Пример заголовка ответа:

```
Content-Type: text/html; charset=UTF-8
Content-Encoding: gzip
```

**Тело сообщения**

В теле сообщения содержатся данные, которые требуется передать. Тело всегда отделяется от заголовков хотя бы одной пустой строкой. В теле, например, может передаваться [HTML-документ](/html/doka/html).

### Модули и расширения

Первые веб-серверы могли передавать только текстовую информацию. Современные веб-серверы работают с файлами различных форматов, позволяют предварительно сжимать и шифровать передаваемые данные, исполнять код на различных языках и привязывать его к контексту запросов и ответов. Весь этот богатый функционал реализуется с помощью различных расширений (модулей, плагинов) с универсальным интерфейсом.

#### Сжатие данных

Для того чтобы можно было ускорить загрузку страниц или файлов на стороне клиента, в современном веб-сервере среди расширений всегда присутствует модуль, который обеспечивает сжатие данных. Перед отправкой клиенту данные предварительно запаковываются, а на стороне клиента распаковываются с помощью одного из алгоритмов сжатия. Долгое время для этого использовался формат сжатия [`gzip`](https://ru.wikipedia.org/wiki/Gzip), и все популярные браузеры его поддерживают.

В последние годы появилась возможность использования ещё двух форматов: [`zopfli`](https://ru.wikipedia.org/wiki/Zopfli) и [`brotli`](https://ru.wikipedia.org/wiki/Brotli). Наиболее перспективным и эффективным является `brotli`. Вы можете посмотреть поддержку этого формата сжатия в браузерах на [Can I Use](https://caniuse.com/?search=brotli).

В контексте современного использования, с помощью сжатия можно оптимизировать загрузку страниц для текстовой части данных: HTML, CSS и JavaScript. Остальные ресурсы, как правило, уже подготовлены для загрузки в браузере. Например, для картинок должны быть найдены оптимальное соотношение визуального качества и степени сжатия, подходящие размеры и плотность пикселей.

#### Шифрование данных

При передаче данных пользователей важным аспектом является их шифрование. Особенности построения сети Интернет позволяют просматривать пакеты данных пользователей, которые проходят множество сетевых узлов, прежде чем окажутся на целевом сетевом устройстве. Если не будет шифрования, то эти данные будут просто в открытом виде: по HTTP передаются текстовые сообщения. Подробнее о безопасности использования Интернета написано [здесь](/js/articles/web-security).

Современные веб-серверы поддерживают несколько способов шифрования данных. Самым распространённым является использование сертификатов. Вы наверняка видели замочек слева от адреса сайта в браузере, который является индикатором того, что сайт безопасен. Специальная организация ставит свою подпись (электронную цифровую подпись в виде сертификата) под контентом, и сайту можно доверять. Браузер может запросить, действует ли эта подпись на данный момент, кем и кому она выдана. Сертификат позволяет понять, можно ли доверять данному сайту или нет.

После проверки сертификата браузер (клиент) и веб-сервер «договариваются» о ключах шифрования (открытом и закрытом). С помощью открытого ключа можно зашифровать данные пользователя на стороне клиента перед отправкой на сервер. Веб-сервер содержит закрытый ключ, с помощью которого эти данные можно расшифровать. Поддерживается схема [шифрования с открытым ключом](https://ru.wikipedia.org/wiki/Криптосистема_с_открытым_ключом). Точно такая же схема используется и для шифрования на веб-сервере перед отправкой данных клиенту. Просто используется другая пара открытого и закрытого ключа.

Подключение сертификата настраивается на стороне веб-сервера, поскольку владелец сайта должен позаботиться о своих пользователях.

#### Проксирование

Современные веб-серверы способны не только отправлять файлы по запросу пользователя, но и перенаправлять запросы клиентов другой программе. Например, можно передать данные другому веб-серверу, который будет специализироваться на определенном типе файлов, или программе-интерпретатору, которая будет исполнять код, получать нужные данные, отдавать их веб-серверу с целью передать их, в конечном счёте, клиенту. Само перенаправление запросов и ответов называется проксированием.

Подробнее о типах веб-приложений написано [здесь](/js/articles/web-app-types).

#### Куки

Веб-сервер не только отдаёт данные. Например, можно получить доступ к кукам браузера пользователя со стороны веб-сервера. Это позволяет сохранять промежуточные данные, которые могут помочь улучшению пользовательского опыта. Существуют и проблемы такой модели, которые связаны с приватностью пользователей в Интернете и их безопасностью.

#### Аутентификация и авторизация

С помощью заголовков в HTTP-сообщениях можно осуществлять аутентификацию и авторизацию пользователей. Это можно реализовать и другим способом, если использовать куки браузера. В современных системах всё чаще применяют более сложные способы аутентификации и авторизации.

Аутентификация пользователей возможна, если веб-серверу отдать учётные данные пользователя. При этом, веб-сервер проксирует эти данные приложению, в котором реализуется процедура аутентификации. В случае успешной аутентификации это приложение посылает ответ клиенту через веб-сервер с уникальным ключом (токеном), который определяет сессию пользователя. Во все запросы от клиента встраивается специальный заголовок, который авторизует пользователя и предоставляет данные, предназначенные только пользователю.

Вы наверняка видели на сайтах аутентификацию через социальные сети или сторонний сервис. Такая аутентификация происходит не на сервере, но результатом является формирование токена, который передаётся в заголовках вместе с запросами от клиента.

Пример заголовка для авторизации клиента на сервере:

```
Authorization: Basic YWxhZGRpbjpvcGVuc2VzYW1l
```

При использовании кук на клиенте создается отдельная запись, в которой указывается уникальный токен сессии. Веб-сервер имеет доступ к этому токену, что позволяет всегда проверить факт валидности авторизации.

Есть и другие способы аутентификации и авторизации, которые поддерживаются веб-сервером.

#### Кэширование

Веб-сервер проводит мониторинг и кэширует ответы клиентам. Это происходит автоматически. Если запросы совпадают, то веб-сервер формирует обновляемый кэш, из которого он сразу отдаёт ответ клиенту, не выполняя обработку запроса. Время обновления актуальности ответа и стратегия кэширования устанавливается в настройках веб-сервера.

Веб-серверы могут обеспечить кэширование и на стороне клиента, чтобы снизить нагрузку на сеть. Для работы с кэшированием используются специальные заголовки. Например, сервер может передать заголовок клиенту:

```
Cache-Control: public, max-age=31536000
```

Такой заголовок сообщит клиенту, что запрошенные данные можно не обновлять целый год (в параметре `max-age` указывается количество секунд). Для статического контента, который редко обновляется или не обновляется вовсе, такой подход позволяет сэкономить массу трафика в сети.
